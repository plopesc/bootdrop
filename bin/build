#!/bin/bash

# Delete and download Drupal
if [[ -e drupal ]]; then
  chmod u+w,g+w -R drupal
  rm -rf drupal
fi
echo "Building Drupal..."
drush make profile/bootdrop-core.make drupal

# Delete profiles and create link to Bootdrop Profile
#rm -rf drupal/profiles/*
ln -s ../../profile drupal/profiles/bootdrop

# Create links for settings and files
if [[ ! -e shared/settings.local.php ]]; then
  cp shared/default.settings.local.php shared/settings.local.php
  echo "Edit shared/settings.local.php with your local database configuration."
fi
ln -s ../../../shared/settings.php drupal/sites/default/settings.php
ln -s ../../../shared/settings.local.php drupal/sites/default/settings.local.php
if [[ ! -e shared/files ]]; then
  mkdir shared/files
  chmod 777 shared/files
fi
ln -s ../../../shared/files drupal/sites/default/files

echo "Building Bootdrop profile..."
rm -rf profile/modules/contrib
rm -rf profile/themes/contrib
cd drupal
drush make --working-copy --no-core --contrib-destination=profiles/bootdrop -y profiles/bootdrop/bootdrop.make
cd -