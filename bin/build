#!/bin/bash

# Delete and download Drupal
if [[ -e drupal ]]; then
  chmod u+w,g+w -R drupal
  rm -rf drupal
fi
echo "Building Drupal..."
drush make bootdrop_profile/bootdrop-core.make drupal

# Delete profiles and create link to Bootdrop Profile
rm -rf drupal/profiles/*
ln -s ../../bootdrop_profile drupal/profiles/bootdrop

# Create links for settings and files
if [[ ! -e shared/settings.local.php ]]; then
  cp shared/default.settings.local.php shared/settings.local.php
  echo "Edit shared/settings.local.php with your local database configuration."
fi
ln -s ../../../shared/settings.php drupal/sites/default/settings.php
ln -s ../../../shared/settings.local.php drupal/sites/default/settings.local.php
if [[ -e shared/files ]]; then
  rm -rf shared/files
fi
mkdir shared/files
chmod 777 shared/files
ln -s ../../../shared/files drupal/sites/default/files

# Link development feature
if [[ ! -e bootdrop_profile/modules/features/bootdrop_development ]]; then
   ln -s ../../../bootdrop_features/bootdrop_development bootdrop_profile/modules/features/bootdrop_development
fi

bin/build_profile